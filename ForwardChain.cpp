/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

/* 
 * File:   main.cpp
 * Author: sai pranav
 *
 * Created on 5 February, 2023, 5:05 AM
 */

#include <cstdlib>
#include "forwardchain.h"
#include<fstream>
#include<bits/stdc++.h>
#include<iostream>
#include<algorithm>
#include<map>
using namespace std;

/*
 * 
 */
forwardChain::forwardChain(){
    ifstream inp;
    string line;
    inp.open("files_notepad/Rules.txt");

    int i=10;
    while(!inp.eof()){
        getline(inp,line);
        string stp;
        int j=1;
        for(j=1;j<line.length();j++){
            int ch=(int)line[j];
            if(ch==32 && ((65<=line[j-1] && 97>=line[j-1])|| (97<=line[j-1] && 122>=line[j-1])) &&((65<=line[j+1] && 97>=line[j+1])||(97<=line[j+1] && 122>=line[j+1]))){
                continue;
            }
            else if(((65<=line[j-1] && 97>=line[j-1])||(97<=line[j-1] && 122>=line[j-1])) && ((65<=line[j] && 97>=line[j])||(97<=line[j] && 122>=line[j])) && (((65<=line[j+1] && 97>=line[j+1])||(97<=line[j+1] && 122>=line[j+1]) || (line[j+1]==' ')||(line[j+1]=='=')))){
                continue;
            }
            else if((line[j]=='=')&&((65<=line[j-1] && 97>=line[j-1])||(97<=line[j-1] && 122>=line[j-1])) && (((65<=line[j+1] && 97>=line[j+1])||(97<=line[j+1] && 122>=line[j+1]) || (line[j+1]==' ')||(line[j+1]=='=')))){
                continue;
            }
            else if((((65<=line[j+1] && 97>=line[j+1])|| (97<=line[j+1] && 122>=line[j+1])) && ((65<=line[j] && 97>=line[j])||(97<=line[j] && 122>=line[j]) ) && (((65<=line[j-1] && 97>=line[j+1])||(97<=line[j-1] && 122>=line[j-1]) || (line[j-1]==' ')||(line[j-1]=='=')))))
           {
                continue;
            }
            else
                break;
        }
        stp=line.substr(0,j+1);
        rules.insert(pair<int,string>(i,stp));
        i=i+10;
    }
    inp.close();
    
    inp.open("files_notepad/Varlists.txt");
    while(!inp.eof()){
        getline(inp,line);       
        string ch="NI"; 
        string stp;
        int j=1;
        for(j=1;j<line.length();j++){
            int ch=(int)line[j];
            if(ch==32 && ((65<=line[j-1] && 97>=line[j-1])|| (97<=line[j-1] && 122>=line[j-1])) &&((65<=line[j+1] && 97>=line[j+1])||(97<=line[j+1] && 122>=line[j+1]))){
                continue;
            }
            else if(((65<=line[j-1] && 97>=line[j-1])||(97<=line[j-1] && 122>=line[j-1])) && ((65<=line[j] && 97>=line[j])||(97<=line[j] && 122>=line[j])) && (((65<=line[j+1] && 97>=line[j+1])||(97<=line[j+1] && 122>=line[j+1]) || (line[j+1]==' ')||(line[j+1]=='=')))){
                continue;
            }
            else if((line[j]=='=')&&((65<=line[j-1] && 97>=line[j-1])||(97<=line[j-1] && 122>=line[j-1])) && (((65<=line[j+1] && 97>=line[j+1])||(97<=line[j+1] && 122>=line[j+1]) || (line[j+1]==' ')||(line[j+1]=='=')))){
                continue;
            }
            else if((((65<=line[j+1] && 97>=line[j+1])|| (97<=line[j+1] && 122>=line[j+1])) && ((65<=line[j] && 97>=line[j])||(97<=line[j] && 122>=line[j]) ) && (((65<=line[j-1] && 97>=line[j+1])||(97<=line[j-1] && 122>=line[j-1]) || (line[j-1]==' ')||(line[j-1]=='=')))))
           {
                continue;
            }
            else
                break;
        }      
        stp=line.substr(0,j+1);
        varList.insert({stp,ch});
    }
    inp.close();

    inp.open("files_notepad/ClauseVarLists.txt");
    i=1;
    while(!inp.eof()){
       getline(inp,line);
        string stp;
        int j=1;
        for(j=1;j<line.length();j++){
            int ch=(int)line[j];
            
            if(ch==32 && ((65<=line[j-1] && 97>=line[j-1])|| (97<=line[j-1] && 122>=line[j-1])) &&((65<=line[j+1] && 97>=line[j+1])||(97<=line[j+1] && 122>=line[j+1]))){
                continue;
            }
            else if(((65<=line[j-1] && 97>=line[j-1])||(97<=line[j-1] && 122>=line[j-1])) && ((65<=line[j] && 97>=line[j])||(97<=line[j] && 122>=line[j])) && (((65<=line[j+1] && 97>=line[j+1])||(97<=line[j+1] && 122>=line[j+1]) || (line[j+1]==' ')||(line[j+1]=='=')))){
                continue;
            }
            else if((line[j]=='=')&&((65<=line[j-1] && 97>=line[j-1])||(97<=line[j-1] && 122>=line[j-1])) && (((65<=line[j+1] && 97>=line[j+1])||(97<=line[j+1] && 122>=line[j+1]) || (line[j+1]==' ')||(line[j+1]=='=')))){
                continue;
            }
            else if((((65<=line[j+1] && 97>=line[j+1])|| (97<=line[j+1] && 122>=line[j+1])) && ((65<=line[j] && 97>=line[j])||(97<=line[j] && 122>=line[j]) ) && (((65<=line[j-1] && 97>=line[j+1])||(97<=line[j-1] && 122>=line[j-1]) || (line[j-1]==' ')||(line[j-1]=='=')))))
           {
                continue;
            }
            else
                break;
        }      
        
        stp=line.substr(0,j+1);
        if(j==1)
            stp="n";
        //cout<<stp<<"\n";
        clauseVarLis.insert(pair<int,string>(i,stp));
        i++;
    }
    inp.close();   
    
    question.insert(pair<string,string>("PREVATTK","Is it a Denial Of Service Attack, Please enter DOS?"));
    question.insert(pair<string,string>("PREVATTKI","Is it a Identity Attack, Please Enter IDA?"));
    question.insert(pair<string,string>("PREVATTKB","Is it a Basic Attack,Please Enter BAS?"));
    question.insert(pair<string,string>("PREVATTKM","Is it a Mallicious Attack,Please Enter MAL?"));
    question.insert(pair<string,string>("CMP","Do you use a cloud mitigation Provider?"));
    question.insert(pair<string,string>("PNW","Does your cloud mitigation provider provides massive amounts of Network Bandwidth?"));
    question.insert(pair<string,string>("PMS","Does CMP have minimum mitigation capacity at multiple sites around the Internet?"));
    question.insert(pair<string,string>("MWA","Do you use firewall software in your system?"));
    question.insert(pair<string,string>("FWSA","Did you code securely and design strong architecture?"));
    question.insert(pair<string,string>("IPATTK","Do you use Internet Service Provider?"));
    question.insert(pair<string,string>("IBW","Do these have more bandwidth than an enterprise would have?"));
    question.insert(pair<string,string>("PIP","Does these have more number of IP address created?"));
    question.insert(pair<string,string>("SID","Did you secure your devices with a strong password so that the attacker wouldn't guess?"));
    question.insert(pair<string,string>("SPMFA","Did you enable Multi-Factor Authentication?"));
    question.insert(pair<string,string>("NOTIFID","Do You receive any notification when you login to your account?"));
    question.insert(pair<string,string>("ESSMA","Do you use any enterprise security software system like Kaspersky,Byte,Bytefence?"));
    question.insert(pair<string,string>("NOTIFMA","Does your system receive notifications of attacks through software?"));
    question.insert(pair<string,string>("SCAN","Will you be able to scan your system for viruses?"));
    question.insert(pair<string,string>("PRSN","Did you set all your social media accounts to private?"));
    question.insert(pair<string,string>("SWUP","Do you regularly update software?"));
    question.insert(pair<string,string>("AUTHUP","Are these authorized updates from your system?"));
    question.insert(pair<string,string>("SECSYS","Do you use any security system?"));
    question.insert(pair<string,string>("SPI","Do these software take any personal information from you?"));
    question.insert(pair<string,string>("UPTECH","Does this software use technologies like like MDX/XDR?"));
    question.insert(pair<string,string>("USEVPN","Do you use any VPN?"));
    question.insert(pair<string,string>("VEXT","Does your VPN help when your connected to VM or when your browsing?"));
    question.insert(pair<string,string>("VRES","Is VPN only used for certain websites?"));
    question.insert(pair<string,string>("SYSROLES","Does your System allow you to create multiple privileges like administrator,user,secure?"));
    question.insert(pair<string,string>("UPREV","Do you use these privileges regularly?"));
    question.insert(pair<string,string>("SCMAIL","Do you scan all incoming emails?"));
    question.insert(pair<string,string>("SPAMFIL","Do you set spam filters to reduce unwanted emails?"));
    question.insert(pair<string,string>("EMAILRES","Does user feel that his/her system is attacked?"));
    question.insert(pair<string,string>("SUBEMAIL","Do you read subject of the email?"));

}

void forwardChain::PrevOFDOS(){
    cout<<"\nPrevention Of Denial Of Service Attack:\n";
    cout<<"Given that Denial of Service (DoS) attacks are becoming more frequent, it is a good time to review the basics and how we can fight back.\n"
          "Cloud Mitigation Provider – Cloud mitigation providers are experts at providing DDoS mitigation from the cloud.\n "
          "This means they have built out massive amounts of network bandwidth and DDoS mitigation capacity at multiple sites\n"
          "around the Internet that can take in any type of network traffic, whether you use multiple ISP’s, your own data center,\n" 
          "or any number of cloud providers. They can scrub the traffic for you and only send “clean” traffic to your data center.\n"
          "Firewall – This is the simplest and least effective method. Generally, someone writes some Python scripts that try to filter\n"
          "out the bad traffic or an enterprise will try and use its existing fire walls to block the traffic\n"
          "Internet Service Provider (ISP) – Some enterprises use their ISP to provide DDoS mitigation.\n"
          "These ISP’s have more bandwidth than an enterprise would, which can help with the large volumetric attacks\n";
}
void forwardChain::PrevOFIDA(){
    cout<<"\nPrevention Of Identity Attack:\n";
    cout<<"\n1.Use an Internet Security Suite\n"
          "\n2.Use Strong Passwords\n"
          "\n3.Keep Your Software Up-to-Date\n"
          "\n4.Avoid Identity Theft\n"
          "\n5.Be careful with links and attachments\n"
          "\n6.Use of Domain-based Message Authentication, Reporting & Conformance (DMARC)\n";
}
void forwardChain::PrevOFBA(){
    cout<<"\nPrevention Of Basic Attack:\n";
    cout<<"\nContinuous Monitoring of Security System: Monitoring the system network helps in checking loopholes that may turn into potential entry points for backdoor attacks.\n"
          "Having Strong fire walls in Computer Network: Firewall filters the traffic in a computer network and a strong firewall can prevent attackers from getting into the system.\n"
          "Protection of computer networks through Strong Passwords: Having a strong password helps in establishing the strong security of the system. Users should never stick to default passwords\n"
          "and should always have passwords that are difficult to crack.\n";

}
void forwardChain::PrevOFMA(){
    cout<<"\nPrevention Of Mallicious Attack:\n";
    cout<<"\n1.Use an Internet Security Suite\n"
          "2.Use Strong Passwords\n"
          "3.Keep Your Software Up-to-Date\n"
          "4.Use security software\n"
          "5.Implement anti-lateral movement\n"
          "6.Use strong passwords and secure authentication\n"
          "7.Educate your users\n"
          "8.Enforce safe browsing and email\n"
          "9.Maintain up-to-date software in use and look for shadow IT\n";
       
}
void forwardChain::findvarinrule(string pat,string txt,int *index)
{
    int M = pat.length();
    int N = txt.length();
    int lps[M];
    computeLPSArray(pat, M, lps);
    int i = 0; 
    int j = 0; 
    while ((N - i) >= (M - j)) {
        if (pat[j] == txt[i]) {
            j++;
            i++;
            
        }
        if (j == M) {
           // printf("Found pattern at index %d ", i - j);
            *index=(i-j);
            j = lps[j - 1];
        }
        else if (i < N && pat[j] != txt[i]) {
            if (j != 0)
                j = lps[j - 1];
            else
                i = i + 1;
        }
    }
}
bool forwardChain::findyesno(string pat,string txt)
{
    int M = pat.length();//strlen(pat);
    int N = txt.length();//strlen(txt);
    
    int lps[M];
    computeLPSArray(pat, M, lps);
    int i = 0; 
    int j = 0; 
    while ((N - i)>=(M - j)) {
        if (pat[j] == txt[i]) {
            j++;
            i++;            
        }
        if(j == M) {
            return true;
            j = lps[j - 1];
        }
        else if (i < N && pat[j] != txt[i]) {
            if (j != 0)
                j = lps[j - 1];
            else
                i = i + 1;
        }
    }
    return false;
}
void forwardChain::computeLPSArray(string pat, int M, int* lps)
{
    int len = 0;
    lps[0] = 0;
    int i = 1;
    while (i < M) {
        if (pat[i] == pat[len]) {
            len++;
            lps[i] = len;
            i++;
        }
        else 
        {
              if (len != 0) {
                len = lps[len - 1];
           }
            else
            {
                lps[i] = 0;
                i++;
            }
        }
    }
}
string forwardChain::edits(string res){
    if(res=="DenialOfService" || res=="DOS")
        return "DOS";
    else if(res=="IdentityAttack" || res=="IDA")
        return "IDA";
    else if(res=="BasicAttack"||res=="BAS")
        return "BAS";
    else
        return "MAL";
}
void forwardChain::questions(){
    string res;    
    cout<<"What Kind of Attack did you faced?";
    cin>>res;
    res=edits(res);
    if(res=="DOS")
     prevention("PREVATTK",0);
    if(res=="IDA")
     prevention("PREVATTKI",0);
    if(res=="BAS")
      prevention("PREVATTKB",0); 
    if(res=="MAL")
      prevention("PREVATTKM",0);
}
     int forwardChain::search(string ser,int i){
             map<int,string>::iterator it=clauseVarLis.begin();
              for(it=next(it,i);it!=clauseVarLis.end();it++){
              if(it->second==ser)
                return it->first;}     
        return -1;}
     void forwardChain::prevention(string clausevar,int jump){            
             int no_of_slot=7;
             int cn=search(clausevar,jump);             
             if(cn==-1)
             {return;}
             int ruleno=((cn/no_of_slot)+1)*10;
             int sp=(cn%no_of_slot);
             int i=cn-sp+1;
             string ch="n";
             while(clauseVarLis.at(i)!=ch){                
                 Conque.push(clauseVarLis[i]);                 
                 i++;
             }
             int len=Conque.size();
             int m=0;
             i=cn-sp+1;            
             while(m<len){  
                 string response;
                 if(varList[clauseVarLis.at(i)]=="NI"){
                     cout<<question[clauseVarLis.at(i)];
                     cin>>response;                     
                     if(clauseVarLis.at(i)=="PREVATTK"||clauseVarLis.at(i)=="PREVATTKI"||clauseVarLis.at(i)=="PREVATTKM"||clauseVarLis.at(i)=="PREVATTKB"){
                         response=edits(response);
                         varList[clauseVarLis.at(i)]=response;
                        }
                     else{
                     transform(response.begin(),response.end(),response.begin(),::toupper);
                        if(response=="YES" || response=="NO")
                            varList[clauseVarLis.at(i)]=response;
                        else{
                            cout << "Wrong input: " << endl;
                            cout << "Please enter only YES or NO" << endl;
                            cout <<question[clauseVarLis.at(i)]<<"(YES/NO): "<<endl;
                            cin >> response;
                            transform(response.begin(),response.end(), response.begin(), ::toupper);
                            varList[clauseVarLis.at(i)]=response;
                        }                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                     }
                 }
                 m++;
                 i++;
             }          
             string rule=rules[ruleno];
             bool t=false;
             len=Conque.size();
             
             while(Conque.empty()==false){
                 string pat=Conque.front(); 
             //cout<<"pat="<<pat<<" ";
               findvarinrule(pat,rule,&indi);               
                string ch=rule.substr(indi+pat.length(),4); 
               // cout<<"ch="<<ch<<" ";
                if(varList.find(pat)!=varList.end()){
                     t=(findyesno(varList[pat],ch));
                    // cout<<"t="<<t<<" ";
                 }  
                if(t==true)
                {Conque.pop();continue;}
                else 
                { break; }            
             } 
             //cout<<t<<" i am out of while \n ";
             if(t==false)
             {   //search(clausevar,cn);
                 while(Conque.empty()==false){Conque.pop();}
                 return prevention(clausevar,cn+1); }
              //need to do recursion} 
             else{
              
                 string pat="THEN ";
                 findvarinrule(pat,rule,&indi);
                 string ch=rule.substr(indi+pat.length(),rule.length());
                 int pos=ch.find("=");
                 string cvar=ch.substr(0,pos);
                 //cout<<cvar<<" ";
                 string ans=ch.substr(pos+1,ch.length());
                 //cout<<ans<<" ";
                 varList[cvar]=ans; 
                               
                 if(varList["PREV"]=="DOS")
                 { PrevOFDOS();}
                 if(varList["PREV"]=="BAS")
                 {PrevOFBA();}
                 if(varList["PREV"]=="MAL")
                 { PrevOFMA();}
                 if(varList["PREV"]=="IDA")
                 { PrevOFIDA();}
                 if(varList["PREV"]=="ZE")
                 {PrevOFMA();PrevOFDOS();PrevOFBA();PrevOFIDA();}                              
                // prevention(cvar,0);
             }
            
     }
     
     
int main(int argc, char** argv) {
    forwardChain fc;
    fc.questions();
    map<int,string>::iterator it;
    //it=fc.varList.begin();
   // for(it=fc.clauseVarLis.begin();it!=fc.clauseVarLis.end();it++)
       // cout<<it->first<<" "<<it->second<<"\n";      
    return 0;
}

